<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>ERP Estamparia</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div id="app" class="app">
    <!-- ========= SIDEBAR ========= -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">BT</div>
        <div class="brand-name">Estamparia ERP</div>

        <!-- Toggle “hambúrguer” (desktop: colapsa; mobile: abre overlay) -->
        <button id="sidebar-toggle" class="toggle-btn" title="Menu">
          <span class="icon">≡</span>
        </button>

        <!-- Botão X (visível só quando overlay mobile estiver aberto) -->
        <button id="sidebar-close" class="mobile-close" aria-label="Fechar menu">×</button>
      </div>

      <nav class="nav">
        <div class="nav-top">
          <!-- Cadastrar -->
          <div class="nav-item" data-submenu="sub-cad">
            <span class="icon">＋</span>
            <span class="label">Cadastrar</span>
            <span class="caret">▾</span>
          </div>
          <div id="sub-cad" class="submenu">
            <a class="submenu-link" href="#/cadastro/produtos"><span class="icon">📦</span> Produtos</a>
            <a class="submenu-link" href="#/cadastro/clientes"><span class="icon">👤</span> Clientes</a>
            <a class="submenu-link" href="#/cadastro/servicos"><span class="icon">🛠️</span> Serviços</a>
            <a class="submenu-link" href="#/cadastro/entradas/produtos"><span class="icon">📥</span> Entrada (Produtos)</a>
            <a class="submenu-link" href="#/cadastro/entradas/servicos"><span class="icon">📥</span> Entrada (Serviços)</a>
            <a class="submenu-link" href="#/cadastro/saidas/produtos"><span class="icon">📤</span> Saída (Produtos)</a>
            <a class="submenu-link" href="#/cadastro/saidas/servicos"><span class="icon">📤</span> Saída (Serviços)</a>
          </div>

          <!-- Consultar -->
          <div class="nav-item" data-submenu="sub-cons">
            <span class="icon">☎</span>
            <span class="label">Consultar</span>
            <span class="caret">▾</span>
          </div>
          <div id="sub-cons" class="submenu">
            <a class="submenu-link" href="#/consulta/produtos"><span class="icon">📦</span> Produtos</a>
            <a class="submenu-link" href="#/consulta/clientes"><span class="icon">👤</span> Clientes</a>
            <a class="submenu-link" href="#/consulta/servicos"><span class="icon">🛠️</span> Serviços</a>
            <a class="submenu-link" href="#/consulta/entradas"><span class="icon">📥</span> Entradas</a>
            <a class="submenu-link" href="#/consulta/saidas"><span class="icon">📤</span> Saídas</a>
          </div>

          <!-- Relatórios -->
          <div class="nav-item" data-submenu="sub-rep">
            <span class="icon">📊</span>
            <span class="label">Relatórios</span>
            <span class="caret">▾</span>
          </div>
          <div id="sub-rep" class="submenu">
            <a class="submenu-link" href="#/relatorios/faturamento"><span class="icon">💵</span> Faturamento</a>
            <a class="submenu-link" href="#/relatorios/fat-por-cliente"><span class="icon">👥</span> Faturamento por Cliente</a>
            <a class="submenu-link" href="#/relatorios/historico-comercial"><span class="icon">🗂️</span> Histórico Comercial</a>
          </div>

          <a class="nav-item" href="#/">
            <span class="icon">🏠</span>
            <span class="label">Dashboard</span>
          </a>
        </div>

        <div class="nav-bottom">
          <a class="nav-item" href="#/configuracoes">
            <span class="icon">⚙️</span>
            <span class="label">Configurações</span>
          </a>
          <a class="nav-item" href="#/perfil">
            <span class="icon">👤</span>
            <span class="label">Perfil</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Backdrop (fecha overlay no mobile) -->
    <div id="sidebar-backdrop" class="backdrop" aria-hidden="true"></div>

    <!-- FAB (botão flutuante – abre overlay no mobile) -->
    <button id="menu-fab" class="menu-fab" title="Abrir menu">☰</button>

    <!-- ========= CONTEÚDO ========= -->
    <main class="content">
      <header class="topbar">
        <h1 id="page-title">Dashboard</h1>
        <div class="userbar">
          <div class="avatar">O</div>
          <div class="name">Operador</div>
          <a href="#/perfil">Perfil</a>
        </div>
      </header>

      <section id="view-root" class="view-root">
        <!-- Conteúdo injetado pelas views -->
      </section>

      <footer class="footerbar">
        <span id="footer-date"></span>
        <span>v37.4.0</span>
      </footer>
    </main>
  </div>

  <!-- ========= SCRIPTS ========= -->
  <!-- Shared / helpers -->
  <script src="shared/types.js"></script>
  <script src="charts.js"></script>

  <!-- Views: cadastro -->
  <script src="views/cadastro-clientes.js"></script>
  <script src="views/cadastro-produtos.js"></script>
  <script src="views/cadastro-servicos.js"></script>
  <script src="views/cadastro-entrada-prod.js"></script>
  <script src="views/cadastro-entrada-serv.js"></script>
  <script src="views/cadastro-saida-prod.js"></script>
  <script src="views/cadastro-saida-serv.js"></script>

  <!-- Views: consultas -->
  <script src="views/consulta-clientes.js"></script>
  <script src="views/consulta-produtos.js"></script>
  <script src="views/consulta-servicos.js"></script>
  <script src="views/consultar-entradas.js"></script>
  <script src="views/consultar-saidas.js"></script>

  <!-- Views: relatórios -->
  <script src="views/rel-faturamento.js"></script>
  <script src="views/rel-fat-por-cliente.js"></script>
  <script src="views/rel-historico-comercial.js"></script>

  <!-- Outras views -->
  <script src="views/configuracoes.js"></script>
  <script src="views/perfil.js"></script>
  <script src="views/dashboard.js"></script>
  <script src="views/lookup-modal.js"></script>

  <!-- Router -->
  <script src="router.js"></script>

  <!-- Submenus (abre/fecha) + Mobile overlay control -->
  <script>
    // Submenus simples
    document.addEventListener('click', (ev) => {
      const trigger = ev.target.closest('.nav-item[data-submenu]');
      if (!trigger) return;
      const id = trigger.getAttribute('data-submenu');
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.toggle('open');
    });

    // Rodapé com data
    (function () {
      const el = document.getElementById('footer-date');
      const d = new Date();
      const f = d.toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit', year:'numeric', weekday:'long' });
      if (el) el.textContent = f;
    })();

    // ===== Controle do overlay mobile (sem remover comportamento desktop) =====
    (function () {
      const app       = document.querySelector('.app');
      const toggleBtn = document.getElementById('sidebar-toggle');
      const closeBtn  = document.getElementById('sidebar-close');
      const backdrop  = document.getElementById('sidebar-backdrop');
      const fab       = document.getElementById('menu-fab');
      const sidebar   = document.querySelector('.sidebar');

      const isMobile = () => window.innerWidth <= 980;

      function openOverlay(){
        app.classList.add('mobile-open');
        fab.classList.add('hide');
      }
      function closeOverlay(){
        app.classList.remove('mobile-open');
        fab.classList.remove('hide');
      }

      // Hambúrguer: desktop = colapsa; mobile = overlay
      toggleBtn?.addEventListener('click', (e) => {
        if (isMobile()) {
          e.preventDefault();
          app.classList.contains('mobile-open') ? closeOverlay() : openOverlay();
        } else {
          app.classList.toggle('collapsed');
        }
      });

      closeBtn?.addEventListener('click', closeOverlay);
      backdrop?.addEventListener('click', closeOverlay);
      fab?.addEventListener('click', openOverlay);

      // Fechar overlay ao clicar em qualquer link/botão do menu (mobile)
      sidebar?.addEventListener('click', (ev) => {
        const hit = ev.target.closest('a,button');
        if (!hit) return;
        if (isMobile()) closeOverlay();
      });

      // Ao redimensionar, garantir estados coerentes
      window.addEventListener('resize', () => {
        if (!isMobile()) {
          app.classList.remove('mobile-open');
          fab?.classList.add('hide');
        } else if (!app.classList.contains('mobile-open')) {
          fab?.classList.remove('hide');
        }
      });

      // Estado inicial do FAB
      if (!isMobile()) fab?.classList.add('hide');
    })();
  </script>
</body>
</html>
